!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/cdk/table"),require("@angular/core"),require("xlsx"),require("file-saver")):"function"==typeof define&&define.amd?define("cdk-table-exporter",["exports","@angular/cdk/table","@angular/core","xlsx","file-saver"],e):e((t=t||self)["cdk-table-exporter"]={},t.ng.cdk.table,t.ng.core,t.xlsx,t.fileSaver)}(this,(function(t,e,r,o,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function a(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function c(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}function p(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function s(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var o,n,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a}function u(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}var l,f=function(){function t(){}return t=c([r.NgModule({declarations:[],imports:[e.CdkTableModule],exports:[]})],t)}();(l=t.ExportType||(t.ExportType={})).XLS="xls",l.XLSX="xlsx",l.CSV="csv",l.TXT="txt",l.JSON="json",l.OTHER="other";var d=function(){function t(){}return t.prototype.extractRows=function(t,e,r){return this.getRowsAsJsonArray(t,e,null!=r?r:t._rowOutlet)},t.prototype.getRowsAsJsonArray=function(t,e,r){var o=this.getRenderedRows(t,r);return this.convertToJsonArray(e,o)},t.prototype.getRenderedRows=function(t,e){return t._getRenderedRows(e)},t.prototype.convertToJsonArray=function(t,e){for(var r=new Array,o=0;o<e.length;o++){var n=this.convertRow(t,e[o]);r.push(this.createExcelItem(n))}return r},t.prototype.convertRow=function(t,e){for(var r=new Array,o=e.children,n=0;n<o.length;n++)if(!this.shouldHide(t,n)){var i=o.item(n).innerText;r.push(i)}return r},t.prototype.shouldHide=function(t,e){return!(!t||!t.includes(e))},t.prototype.createExcelItem=function(t){return Object.assign({},t)},t.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new t},token:t,providedIn:"root"}),t=c([r.Injectable({providedIn:"root"}),p("design:paramtypes",[])],t)}(),h=function(t,e){this.extension=t,this.contentTypeHeader=e},y=t.ExportType.TXT+"/",g="."+t.ExportType.XLS,x="."+t.ExportType.XLSX,T="."+t.ExportType.CSV,v="."+t.ExportType.JSON,E="."+t.ExportType.TXT,_=new h(g,"application/octet-stream;charset=utf-8"),S=new h(x,"application/octet-stream;charset=utf-8"),w=new h(v,y+JSON+";charset=utf-8"),m=new h(E,y+t.ExportType.TXT+";charset=utf-8"),O=new h(T,y+t.ExportType.CSV+";charset=utf-8"),b=".*."+t.ExportType.XLS+"$",I=function(){function e(){}return e.save=function(t,e,r){var o=new Blob([t],{type:e.contentTypeHeader}),i="mat-table-exporter";r&&r.fileName&&(i=r.fileName),n.saveAs(o,i+e.extension)},e.isXls=function(t){return null!=t.toLowerCase().match(b)},e.identifyExportType=function(r){return r&&e.isXls(r)?t.ExportType.XLS:t.ExportType.XLSX},e.removeExtension=function(t){t.fileName=t.fileName.split(".")[0]},e}(),R=function(){function t(){}return t.prototype.export=function(t,e){if(!t)throw new Error("Empty json array is provided, rows parameter is mandatory!");var r=this.createContent(t,e),o=this.getMimeType();I.save(r,o,e)},t}(),C=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.createContent=function(t,e){var r=o.utils.json_to_sheet(t,{skipHeader:!0});return this.workSheetToContent(r,e)},e}(R),X=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.workSheetToContent=function(t,e){var r,n;return o.utils.sheet_to_csv(t,{FS:(n=null===(r=e)||void 0===r?void 0:r.delimiter,null!=n?n:",")})},e.prototype.getMimeType=function(){return O},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=c([r.Injectable({providedIn:"root"}),p("design:paramtypes",[])],e)}(C),j=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.createContent=function(t,e){var r=this,o="";return t.forEach((function(t){o+=Object.values(t).join(r.getDelimiter(e))+"\n"})),o},e.prototype.getMimeType=function(){return m},e.prototype.getDelimiter=function(t){return t&&t.delimiter?t.delimiter:"\t"},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=c([r.Injectable({providedIn:"root"}),p("design:paramtypes",[])],e)}(R),P=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.workSheetToContent=function(t,e){void 0===e&&(e={});var r=o.utils.book_new();return e.columnWidths&&(t["!cols"]=this.convertToWch(e.columnWidths)),this.correctTypes(e),o.utils.book_append_sheet(r,t,e.sheet),o.write(r,e)},e.prototype.getMimeType=function(){return _},e.prototype.correctTypes=function(t){t.type||(t.type="array"),t.bookType=this.getMimeType().extension.replace(".","")},e.prototype.convertToWch=function(t){return t.map((function(t){return{wch:t}}))},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=c([r.Injectable({providedIn:"root"}),p("design:paramtypes",[])],e)}(C),N=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.createContent=function(t,e){return JSON.stringify(t)},e.prototype.getMimeType=function(){return w},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=c([r.Injectable({providedIn:"root"}),p("design:paramtypes",[])],e)}(R),M=function(t){function e(){return t.call(this)||this}return a(e,t),e.prototype.getMimeType=function(){return S},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e},token:e,providedIn:"root"}),e=c([r.Injectable({providedIn:"root"}),p("design:paramtypes",[])],e)}(P),k=function(){function e(t){this.injector=t}return e.prototype.getService=function(e){switch(e){case t.ExportType.XLS.valueOf():return this.injector.get(P);case t.ExportType.XLSX.valueOf():return this.injector.get(M);case t.ExportType.JSON.valueOf():return this.injector.get(N);case t.ExportType.TXT.valueOf():return this.injector.get(j);case t.ExportType.CSV.valueOf():return this.injector.get(X);case t.ExportType.OTHER.valueOf():return null;default:return this.injector.get(M)}},e.ctorParameters=function(){return[{type:r.Injector}]},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e(r["ɵɵinject"](r.INJECTOR))},token:e,providedIn:"root"}),e=c([r.Injectable({providedIn:"root"}),p("design:paramtypes",[r.Injector])],e)}(),L=function(){function e(t,e,o,n){this.renderer=t,this.serviceLocator=e,this.dataExtractor=o,this._cdkTable=n,this.exportCompleted=new r.EventEmitter,this.exportStarted=new r.EventEmitter}return e.prototype.exportTable=function(t,e){this.loadExporter(t),this._options=e,this.exportStarted.emit(),this._isIterating=!0,this._isExporting=!0,this._data=new Array,this.extractTableHeader();try{this.exportWithPagination()}catch(t){this.exportSinglePage()}},e.prototype.toggleRow=function(t){var e=this.getPaginatedRowIndex(t);this.isToggleOn(e)?this.toggleOff(e):this.toggleOn(e)},e.prototype.resetToggleRows=function(){this._selectedRows=[]},e.prototype.toggleOn=function(t){this._selectedRows=u(this._selectedRows||[],[t])},e.prototype.toggleOff=function(t){this._selectedRows=this._selectedRows.filter((function(e){return e!==t}))},e.prototype.isToggleOn=function(t){var e;return null===(e=this._selectedRows)||void 0===e?void 0:e.includes(t)},e.prototype.loadExporter=function(e){e===t.ExportType.OTHER.valueOf()?this._exporterService=this.exporter:this._exporterService=this.serviceLocator.getService(e)},e.prototype.exportWithPagination=function(){this._initialPageIndex=this.getCurrentPageIndex(),this.initPageHandler(),this.goToPage(0)},e.prototype.exportSinglePage=function(){this.extractDataOnCurrentPage(),this.extractTableFooter(),this.exportExtractedData()},e.prototype.extractDataOnCurrentPage=function(){var t=this.dataExtractor.extractRows(this._cdkTable,this.hiddenColumns);this._data=this._data.concat(this.getSelectedRows(t))},e.prototype.getSelectedRows=function(t){var e=this;return this.isSelectiveExport()?t.filter((function(t,r){return e._selectedRows.includes(e.getPaginatedRowIndex(r))})):t},e.prototype.isSelectiveExport=function(){return this._selectedRows&&!this.isMasterToggleOff()&&!this.isMasterToggleOn()},e.prototype.isMasterToggleOn=function(){return this.compareSelectedRowCount(this.getTotalItemsCount())},e.prototype.isMasterToggleOff=function(){return this.compareSelectedRowCount(0)},e.prototype.compareSelectedRowCount=function(t){var e;return!((null===(e=this._selectedRows)||void 0===e?void 0:e.length)!==t)},e.prototype.initPageHandler=function(){var t=this;this._subscription||(this._subscription=this.getPageChangeObservable().subscribe((function(){setTimeout((function(){t._isIterating?(t.extractDataOnCurrentPage(),t.hasNextPage()?t.nextPage():(t._isIterating=!1,t.goToPage(t._initialPageIndex))):t._isExporting&&(t._isExporting=!1,t.extractTableFooter(),t.exportExtractedData())}))})))},e.prototype.exportExtractedData=function(){this._exporterService.export(this._data,this._options),this._data=new Array,this.exportCompleted.emit()},e.prototype.extractSpecialRows=function(t){var e;(e=this._data).push.apply(e,u(this.dataExtractor.extractRows(this._cdkTable,this.hiddenColumns,t)))},e.prototype.extractTableHeader=function(){this.extractSpecialRows(this._cdkTable._headerRowOutlet)},e.prototype.extractTableFooter=function(){this.extractSpecialRows(this._cdkTable._footerRowOutlet)},e.prototype.hasNextPage=function(){return this.getCurrentPageIndex()<this.getPageCount()-1},e.prototype.nextPage=function(){this.goToPage(this.getCurrentPageIndex()+1)},e.prototype.getPaginatedRowIndex=function(t){return t+this.getPageSize()*this.getCurrentPageIndex()},e.ctorParameters=function(){return[{type:r.Renderer2},{type:k},{type:d},{type:void 0}]},c([r.Input(),p("design:type",Array)],e.prototype,"hiddenColumns",void 0),c([r.Input(),p("design:type",Object)],e.prototype,"exporter",void 0),c([r.Output(),p("design:type",Object)],e.prototype,"exportCompleted",void 0),c([r.Output(),p("design:type",Object)],e.prototype,"exportStarted",void 0),e=c([r.Directive(),p("design:paramtypes",[r.Renderer2,k,d,Object])],e)}();t.CHAR_SET_UTF=";charset=utf-",t.CHAR_SET_UTF_8=";charset=utf-8",t.COMMA=",",t.CONTENT_TYPE_APPLICATION="application/",t.CONTENT_TYPE_EXCEL="application/octet-stream",t.CONTENT_TYPE_TEXT=y,t.CdkTableExporter=L,t.CdkTableExporterModule=f,t.CsvExporterService=X,t.DOT=".",t.DataExtractorService=d,t.EXTENSION_CSV=T,t.EXTENSION_JSON=v,t.EXTENSION_TEXT=E,t.EXTENSION_XLS=g,t.EXTENSION_XLSX=x,t.FileExporter=R,t.FileUtil=I,t.JsonExporterService=N,t.MAT_TABLE_EXPORTER="mat-table-exporter",t.MIME_CSV=O,t.MIME_EXCEL_XLS=_,t.MIME_EXCEL_XLSX=S,t.MIME_JSON=w,t.MIME_TXT=m,t.Mime=h,t.REF="!ref",t.RETURN="\n",t.ServiceLocatorService=k,t.TAB="\t",t.TYPE_ARRAY="array",t.TxtExporterService=j,t.WorksheetExporter=C,t.XLSX_COLS="!cols",t.XLS_REGEX=b,t.XlsExporterService=P,t.XlsxExporterService=M,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=cdk-table-exporter.umd.min.js.map